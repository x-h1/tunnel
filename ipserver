#!/bin/bash
# ALL TRAFIC IPTABLES
ETH=$(ip -o $ETH -4 route show to default | awk '{print $5}');
    cat >/etc/iptables/rules.v4 <<-END
# Generated by iptables-save v1.8.4 on Thu Dec 29 03:14:18 2022
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10074 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10073 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10072 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10040 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10030 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 18020 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10015 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10012 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10011 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10008 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10007 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10006 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10005 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10004 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10003 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10002 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10001 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 10000 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 3128 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 1194 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 109 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 169 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 88 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 68 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 53 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 2200 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 5300 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 5300 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 7100 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 7200 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 7300 -j ACCEPT
-A FORWARD -m string --string "BitTorrent" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "BitTorrent protocol" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "peer_id=" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string ".torrent" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "announce.php?passkey=" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "torrent" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "announce" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "info_hash" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "/default.ida?" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string ".exe?/c+dir" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string ".exe?/c_tftp" --algo bm --to 65535 -j DROP
-A FORWARD -m string --string "peer_id" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "BitTorrent" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "BitTorrent protocol" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "bittorrent-announce" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "announce.php?passkey=" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "find_node" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "info_hash" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "get_peers" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "announce" --algo kmp --to 65535 -j DROP
-A FORWARD -m string --string "announce_peers" --algo kmp --to 65535 -j DROP
COMMIT
# Completed on Thu Dec 29 03:14:18 2022
# Generated by iptables-save v1.8.4 on Thu Dec 29 03:14:18 2022
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A PREROUTING -i $ETH -p udp -m udp --dport 53 -j REDIRECT --to-ports 5300
-A POSTROUTING -s 10.7.0.0/24 -o $ETH -j MASQUERADE
-A POSTROUTING -s 10.6.0.0/24 -o $ETH -j MASQUERADE
COMMIT
# Completed on Thu Dec 29 03:14:18 2022
END
systemctl restart netfilter-persistent
systemctl enable iptables >/dev/null 2>&1 
systemctl start iptables >/dev/null 2>&1 
systemctl restart iptables >/dev/null 2>&1 
